<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>VIP Veiling</title>

<style>
:root{
 --red:#b30000;
 --bg1:#0b0b0b;
 --bg2:#161616;
 --line:rgba(140,0,0,.45);
 --muted:#9a9a9a;
 --ok:#00c36a;
 --err:#ff4d4d;
}
body{
 margin:0;
 font-family:system-ui,Arial;
 background:#000;
 color:#fff;
}
.wrap{
 max-width:720px;
 margin:0 auto;
 padding:20px;
}
.card{
 background:linear-gradient(145deg,var(--bg1),var(--bg2));
 border:1px solid var(--line);
 border-radius:14px;
 padding:20px;
 margin:20px 0;
}
.big{
 font-size:1.6rem;
 font-weight:700;
 color:var(--red);
}
.muted{color:var(--muted);}
.row{display:flex;gap:12px;flex-wrap:wrap;}
.col{flex:1;min-width:220px;}
input,select{
 width:100%;
 padding:10px;
 border-radius:8px;
 border:1px solid #333;
 background:#121212;
 color:#fff;
 box-sizing:border-box;
}
button{
 margin-top:16px;
 padding:12px 18px;
 border-radius:8px;
 border:none;
 cursor:pointer;
 background:linear-gradient(145deg,#7a0000,var(--red));
 color:#fff;
 font-weight:600;
}
.msg{margin-top:10px;}
.msg.ok{color:var(--ok);}
.msg.err{color:var(--err);}
.top10item{
 padding:6px 0;
 border-bottom:1px dashed rgba(120,0,0,.2);
}
.checkbox-box{
 margin-top:15px;
 font-size:14px;
}
.checkbox-box a{
 color:#ff4d4d;
 text-decoration:none;
}
.checkbox-box a:hover{text-decoration:underline;}

.popup{
 display:none;
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.85);
}
.popup-content{
 background:#1a1a1a;
 max-width:400px;
 margin:150px auto;
 padding:25px;
 border-radius:10px;
 text-align:center;
}
</style>
</head>

<body>
<div class="wrap">

<div class="card">
<div class="big">Huidig hoogste bod: <span id="highestBid">…</span></div>
<div class="muted">
Minimale verhoging: €<span id="minInc">5</span> •
Minimaal bod: <span id="requiredMin">…</span>
</div>
<div class="muted" id="endsInfo"></div>
</div>

<div class="card">
<h3>Plaats je bod</h3>

<form id="bidForm">

<label>Kies speelavond:</label>
<select id="auctionSelect"></select>

<div class="row">
<div class="col">
<label>Voornaam</label>
<input id="firstName" required>
</div>
<div class="col">
<label>Achternaam</label>
<input id="lastName" required>
</div>
</div>

<div class="row">
<div class="col">
<label>E-mail</label>
<input id="email" type="email" required>
</div>
<div class="col">
<label>Telefoon</label>
<input id="phone" required>
</div>
</div>

<label>Bod (€)</label>
<input id="bid" type="number" min="50" required>

<div class="checkbox-box">
<label>
<input type="checkbox" id="voorwaardenCheck">
Ik ga akkoord met de
<a href="https://www.toneelvereniginglely.nl/algemene-voorwaarden" target="_blank">
algemene voorwaarden
</a>
en begrijp dat mijn bod bindend is.
</label>
</div>

<button type="submit">Bod plaatsen</button>
<div id="msg" class="msg"></div>

</form>

<div style="margin-top:20px">
<h4>Top 10 biedingen</h4>
<div id="top10" class="muted">Laden…</div>
</div>

</div>
</div>

<!-- POPUP -->
<div id="confirmPopup" class="popup">
<div class="popup-content">
<h2>Bevestig je bod</h2>
<p>Dit bod is bindend en kan niet worden ingetrokken.</p>
<button onclick="confirmBid()">Bevestigen</button>
<button onclick="closePopup()">Annuleren</button>
</div>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbyPahgvyBD-8kr4-gI2pqIAe1q_iGgF0YbZqd-Sp2-YdBvoMPfmQoS0T59gsBaBrDiMXA/exec";
const START_BID=50;

const AUCTIONS=[
{id:"2027-01-22",label:"Vrijdag 22 januari 2027"},
{id:"2027-01-23",label:"Zaterdag 23 januari 2027"},
{id:"2027-01-24",label:"Zondag 24 januari 2027"},
{id:"2027-01-29",label:"Vrijdag 29 januari 2027"},
{id:"2027-01-30",label:"Zaterdag 30 januari 2027"}
];

const $=id=>document.getElementById(id);
const euro=n=>"€"+Number(n).toLocaleString("nl-NL");

let highest=0,minInc=5;

AUCTIONS.forEach(a=>{
 const o=document.createElement("option");
 o.value=a.id;
 o.textContent=a.label;
 $("auctionSelect").appendChild(o);
});

async function refresh(){
 try{
  const res=await fetch(API_URL+"?auction="+$("auctionSelect").value);
  const data=await res.json();
  if(!data.ok) throw new Error();

  highest=data.highestBid||0;
  minInc=data.minIncrement||5;

  const required=data.requiredMin||START_BID;

  $("highestBid").textContent=highest?euro(highest):"€50 (startbod)";
  $("requiredMin").textContent=euro(required);
  $("bid").min=required;

  if(data.top10?.length){
    $("top10").innerHTML=data.top10.map(r=>
      `<div class="top10item">${r.date} - ${r.name} - ${euro(r.bid)}</div>`
    ).join("");
  }else{
    $("top10").textContent="Nog geen biedingen.";
  }

 }catch{
   $("msg").textContent="Fout bij laden.";
 }
}

$("auctionSelect").addEventListener("change",refresh);

$("bidForm").addEventListener("submit",e=>{
 e.preventDefault();

 if(!$("voorwaardenCheck").checked){
  alert("Je moet akkoord gaan met de voorwaarden.");
  return;
 }

 const bid=Number($("bid").value);
 if(bid<Number($("bid").min)){
  alert("Te laag bod.");
  return;
 }

 $("confirmPopup").style.display="block";
});

function closePopup(){
 $("confirmPopup").style.display="none";
}

async function confirmBid(){
 closePopup();

 const formData=new URLSearchParams();
 formData.append("auction",$("auctionSelect").value);
 formData.append("firstName",$("firstName").value);
 formData.append("lastName",$("lastName").value);
 formData.append("email",$("email").value);
 formData.append("phone",$("phone").value);
 formData.append("bid",$("bid").value);

 await fetch(API_URL,{
  method:"POST",
  body:formData
 });

 $("msg").textContent="Bod geplaatst!";
 $("bidForm").reset();
 refresh();
}

refresh();
setInterval(refresh,15000);
</script>
</body>
</html>
