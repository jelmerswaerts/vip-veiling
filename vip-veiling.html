<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>VIP Veiling</title>

<style>
:root{
 --red:#b30000;
 --bg1:#0b0b0b;
 --bg2:#161616;
 --line:rgba(140,0,0,.45);
 --muted:#9a9a9a;
 --ok:#00c36a;
 --err:#ff4d4d;
}

body{
 margin:0;
 font-family:system-ui,Arial;
 background:#000;
 color:#e8e8e8;
}

.wrap{
 max-width:720px;
 margin:0 auto;
 padding:20px;
}

.card{
 background:linear-gradient(145deg,var(--bg1),var(--bg2));
 border:1px solid var(--line);
 border-radius:14px;
 padding:20px;
 margin-bottom:20px;
 box-shadow:0 0 20px rgba(0,0,0,0.8);
}

.big{
 font-size:1.6rem;
 font-weight:700;
 color:var(--red);
}

label{
 display:block;
 margin:12px 0 6px;
}

input,select{
 width:100%;
 padding:10px;
 border-radius:8px;
 border:1px solid #333;
 background:#121212;
 color:#fff;
 box-sizing:border-box;
}

button{
 margin-top:16px;
 padding:12px 18px;
 border-radius:8px;
 border:none;
 cursor:pointer;
 background:linear-gradient(145deg,#7a0000,var(--red));
 color:#fff;
 font-weight:600;
 width:100%;
}

button:hover{
 opacity:0.9;
}

.msg{
 margin-top:10px;
}

.msg.ok{color:var(--ok)}
.msg.err{color:var(--err)}

.top10item{
 padding:6px 0;
 border-bottom:1px dashed rgba(120,0,0,.2)
}

.voorwaarden{
 font-size:0.85rem;
 margin-top:12px;
 color:var(--muted);
 text-align:center;
 line-height:1.4;
}

.voorwaarden a{
 color:var(--red);
 text-decoration:none;
 font-weight:600;
}

.voorwaarden a:hover{
 text-decoration:underline;
}

/* popup */
.popup{
 display:none;
 position:fixed;
 top:0;
 left:0;
 width:100%;
 height:100%;
 background:rgba(0,0,0,0.8);
 justify-content:center;
 align-items:center;
}

.popup-content{
 background:#111;
 padding:25px;
 border-radius:12px;
 width:90%;
 max-width:400px;
 text-align:center;
}

.popup-content button{
 width:auto;
 margin:10px;
}
</style>
</head>

<body>
<div class="wrap">

<div class="card">
<div class="big">
Huidig hoogste bod: <span id="highestBid">…</span>
</div>
<div style="margin-top:6px;color:#9a9a9a;">
Minimaal bod: <span id="requiredMin">…</span>
</div>
</div>

<div class="card">
<h3>Plaats je bod</h3>

<form id="bidForm">

<label>Kies speelavond:</label>
<select id="auctionSelect"></select>

<label>Voornaam</label>
<input id="firstName" required>

<label>Achternaam</label>
<input id="lastName" required>

<label>E-mail</label>
<input id="email" type="email" required>

<label>Telefoon</label>
<input id="phone" required>

<label>Bod (€)</label>
<input id="bid" type="number" min="50" step="1" required>

<button type="submit">Bod plaatsen</button>

<div class="voorwaarden">
Door op <strong>“Bod plaatsen”</strong> te klikken gaat u akkoord met onze
<a href="https://www.toneelvereniginglely.nl/algemene-voorwaarden" target="_blank">
algemene voorwaarden
</a>
en begrijpt u dat uw bod bindend is.
</div>

<div id="msg" class="msg"></div>
</form>

<div style="margin-top:20px">
<h4>Top 10 biedingen</h4>
<div id="top10" style="color:#9a9a9a">Laden…</div>
</div>

</div>
</div>

<!-- Confirm popup -->
<div id="confirmPopup" class="popup">
<div class="popup-content">
<h3>Weet u het zeker?</h3>
<p>Uw bod is bindend en kan niet worden ingetrokken.</p>
<button onclick="confirmBid()">Ja, plaats bod</button>
<button onclick="closePopup()">Annuleren</button>
</div>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbyPahgvyBD-8kr4-gI2pqIAe1q_iGgF0YbZqd-Sp2-YdBvoMPfmQoS0T59gsBaBrDiMXA/exec";
const START_BID=50;

const AUCTIONS=[
{id:"2027-01-22",label:"Vrijdag 22 januari 2027"},
{id:"2027-01-23",label:"Zaterdag 23 januari 2027"},
{id:"2027-01-24",label:"Zondag 24 januari 2027"},
{id:"2027-01-29",label:"Vrijdag 29 januari 2027"},
{id:"2027-01-30",label:"Zaterdag 30 januari 2027"}
];

const $=id=>document.getElementById(id);
const euro=n=>"€"+Number(n).toLocaleString("nl-NL");

let highest=0,minInc=5;

AUCTIONS.forEach(a=>{
 const o=document.createElement("option");
 o.value=a.id;
 o.textContent=a.label;
 $("auctionSelect").appendChild(o);
});

async function refresh(){
 try{
  const res=await fetch(API_URL+"?auction="+$("auctionSelect").value);
  const data=await res.json();
  if(!data.ok) throw new Error();

  highest=data.highestBid||0;
  minInc=data.minIncrement||5;

  const required=data.requiredMin||START_BID;

  $("highestBid").textContent=highest?euro(highest):"€50 (startbod)";
  $("requiredMin").textContent=euro(required);
  $("bid").min=required;

  if(data.top10?.length){
    $("top10").innerHTML=data.top10.map(r=>
      `<div class="top10item">${r.date} - ${r.name} - ${euro(r.bid)}</div>`
    ).join("");
  }else{
    $("top10").textContent="Nog geen biedingen.";
  }

 }catch{
   $("msg").textContent="Fout bij laden.";
 }
}

$("auctionSelect").addEventListener("change",refresh);

$("bidForm").addEventListener("submit",e=>{
 e.preventDefault();

 const bid=Number($("bid").value);
 if(bid<Number($("bid").min)){
  alert("Te laag bod.");
  return;
 }

 $("confirmPopup").style.display="flex";
});

function closePopup(){
 $("confirmPopup").style.display="none";
}

async function confirmBid(){
 closePopup();

 const formData=new URLSearchParams();
 formData.append("auction",$("auctionSelect").value);
 formData.append("firstName",$("firstName").value);
 formData.append("lastName",$("lastName").value);
 formData.append("email",$("email").value);
 formData.append("phone",$("phone").value);
 formData.append("bid",$("bid").value);

 await fetch(API_URL,{
  method:"POST",
  body:formData
 });

 $("msg").textContent="Bod geplaatst!";
 $("bidForm").reset();
 refresh();
}

refresh();
setInterval(refresh,15000);
</script>

</body>
</html>
